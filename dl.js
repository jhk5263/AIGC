// ==UserScript==
// @name         视频下载器(test)
// @namespace    http://tampermonkey.net/
// @version      1.271
// @description  在 TopMediAI 的文本转视频页面，当视频生成后自动添加一个下载按钮。
// @author       haway
// @match        *.topmediai.com/*
// @icon         https://www.topmediai.com/favicon.ico
// @grant        none
// @license      MIT
// @updateURL    https://co.taotile.ltd/dl.js
// @downloadURL  https://co.taotile.ltd/dl.js
// ==/UserScript==
function _0x1364(_0x1eb12f,_0x17a913){const _0x9169db=_0x9169();return _0x1364=function(_0x136486,_0x457d15){_0x136486=_0x136486-0x64;let _0x5685c5=_0x9169db[_0x136486];return _0x5685c5;},_0x1364(_0x1eb12f,_0x17a913);}function _0x9169(){const _0x367b74=['4432fqogeZ','error','video','body','forEach','innerHTML','5257UsGbic','16TDxfQM','revokeObjectURL','[Tampermonkey]\x20','textContent','remove','is-downloading','[Tampermonkey]\x20开始强制下载\x20(','href','903155MzJOHL','downloadHandlerAttached','下载失败','log','849312kPrxgh','20547iQtCan','src','download','catch','tagName','classList','[Tampermonkey]\x20无法找到有效的视频源链接。','source','closest','dataset','):\x20','.el-dialog__body','add','createElement','click','addEventListener','1438918BbLeof','%cTopMediAI\x20下载脚本\x20v4.2\x20(最终修正版)\x20已启动。','finally','true','video[controls]:not(.el-dialog__body\x20video)','preventDefault','appendChild','1qvWLTQ','querySelector','1736970fryHch','style','then','observe','1320900KulpQV','BUTTON','createObjectURL','removeChild','Main\x20Page','display','Popup'];_0x9169=function(){return _0x367b74;};return _0x9169();}(function(_0x208246,_0x36ab30){const _0x46a493=_0x1364,_0x535aab=_0x208246();while(!![]){try{const _0x1d3163=parseInt(_0x46a493(0x8d))/0x1*(-parseInt(_0x46a493(0x86))/0x2)+parseInt(_0x46a493(0x8f))/0x3+-parseInt(_0x46a493(0x69))/0x4*(-parseInt(_0x46a493(0x71))/0x5)+parseInt(_0x46a493(0x75))/0x6+-parseInt(_0x46a493(0x68))/0x7*(parseInt(_0x46a493(0x9a))/0x8)+parseInt(_0x46a493(0x76))/0x9+parseInt(_0x46a493(0x93))/0xa;if(_0x1d3163===_0x36ab30)break;else _0x535aab['push'](_0x535aab['shift']());}catch(_0x172b43){_0x535aab['push'](_0x535aab['shift']());}}}(_0x9169,0x6be46),(function(){'use strict';const _0x23e2b8=_0x1364;console[_0x23e2b8(0x74)](_0x23e2b8(0x87),'color:\x20blue;\x20font-size:\x2016px;\x20font-weight:\x20bold;');const _0x4c1949=document[_0x23e2b8(0x83)](_0x23e2b8(0x90));_0x4c1949[_0x23e2b8(0x6c)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20button.download-btn.is-downloading,\x20a.download-btn.is-downloading\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pointer-events:\x20none;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20',document['head'][_0x23e2b8(0x8c)](_0x4c1949);function _0xa8cde8(_0x3755ab){if(!_0x3755ab)return'topmediai-video.mp4';try{const _0x3827c9=new URL(_0x3755ab)['pathname'],_0x1fa00c=_0x3827c9['substring'](_0x3827c9['lastIndexOf']('/')+0x1);return _0x1fa00c||'topmediai-video.mp4';}catch(_0x7ee7fd){return'topmediai-video.mp4';}}function _0x19445b(_0x14f70f,_0x196fdb,_0x13ad1c){const _0xae36dc=_0x23e2b8;if(!_0x14f70f||!_0x196fdb||_0x14f70f[_0xae36dc(0x7f)][_0xae36dc(0x72)])return;_0x14f70f[_0xae36dc(0x7f)]['downloadHandlerAttached']=_0xae36dc(0x89);if(_0x14f70f[_0xae36dc(0x7a)]!==_0xae36dc(0x94))return;_0x14f70f[_0xae36dc(0x85)](_0xae36dc(0x84),_0x19f883=>{const _0x5efe76=_0xae36dc;_0x19f883[_0x5efe76(0x8b)](),_0x19f883['stopPropagation']();const _0x358d49=_0x14f70f[_0x5efe76(0x67)],_0x1444b0=_0x196fdb[_0x5efe76(0x8e)](_0x5efe76(0x7d)),_0x506dd4=_0x1444b0?_0x1444b0['src']:_0x196fdb[_0x5efe76(0x77)];if(!_0x506dd4){console['error'](_0x5efe76(0x7c));return;}const _0x5ac8db=_0xa8cde8(_0x506dd4);console['log'](_0x5efe76(0x6f)+_0x13ad1c+_0x5efe76(0x80)+_0x5ac8db),_0x14f70f['innerHTML']='下载中...',_0x14f70f[_0x5efe76(0x7b)][_0x5efe76(0x82)](_0x5efe76(0x6e)),fetch(_0x506dd4)[_0x5efe76(0x91)](_0xc4528e=>_0xc4528e['blob']())[_0x5efe76(0x91)](_0x40aac9=>{const _0x2fc128=_0x5efe76,_0x4eab64=URL[_0x2fc128(0x95)](_0x40aac9),_0x47789e=document[_0x2fc128(0x83)]('a');_0x47789e[_0x2fc128(0x90)][_0x2fc128(0x98)]='none',_0x47789e[_0x2fc128(0x70)]=_0x4eab64,_0x47789e['setAttribute'](_0x2fc128(0x78),_0x5ac8db),document[_0x2fc128(0x65)][_0x2fc128(0x8c)](_0x47789e),_0x47789e['click'](),document[_0x2fc128(0x65)][_0x2fc128(0x96)](_0x47789e),URL[_0x2fc128(0x6a)](_0x4eab64);})[_0x5efe76(0x79)](_0x657885=>{const _0x43296d=_0x5efe76;console[_0x43296d(0x9b)]('下载失败:',_0x657885),_0x14f70f['innerHTML']=_0x43296d(0x73);})[_0x5efe76(0x88)](()=>{setTimeout(()=>{const _0x3f3a72=_0x1364;_0x14f70f[_0x3f3a72(0x67)]=_0x358d49,_0x14f70f['classList'][_0x3f3a72(0x6d)](_0x3f3a72(0x6e));},0x3e8);});},!![]),console[_0xae36dc(0x74)](_0xae36dc(0x6b)+_0x13ad1c+'\x20的下载按钮已成功绑定功能。');}function _0x291bf1(){const _0x1fc7cc=_0x23e2b8,_0xaf9022=document['querySelectorAll']('button.download-btn:not([data-download-handler-attached])');_0xaf9022[_0x1fc7cc(0x66)](_0x24fbbf=>{const _0x894a29=_0x1fc7cc,_0x1472b7=_0x24fbbf[_0x894a29(0x7e)](_0x894a29(0x81));if(_0x1472b7){const _0x3c57a9=_0x1472b7[_0x894a29(0x8e)](_0x894a29(0x649445b(_0x24fbbf,_0x42cc68,_0x894a29(0x97));}});}const _0x4c5eb9=new MutationObserver(_0x291bf1);_0x4c5eb9[_0x23e2b8(0x92)](document[_0x23e2b8(0x65)],{'childList':!![],'subtree':!![]});}()));
